<link rel="stylesheet" href="https://unpkg.com/@cds/core/global.min.css" />
<link rel="stylesheet" href="https://unpkg.com/@cds/core/styles/theme.dark.min.css" />
<link rel="stylesheet" href="https://unpkg.com/@clr/ui/clr-ui.min.css" />


<body cds-theme="light">
    <div class="content-area" style="padding: 0 16px" >
        <div>
            <a class="btn btn-sm" target="_blank" href="https://guidance.clarity.design" id="showToastButton">CIP Home PAge</a>
            <button class="btn btn-sm" id="checkViolations">No Hex Values</button>
            <button class="btn btn-sm" id="detachedNodes">detached nodes</button>
            <button class="btn btn-danger btn-sm" id="closeButton">Close</button>
        </div>
        <div id="showViolation" class="clr-row" style="display: none;">
            <div class="clr-col-lg-5 clr-col-md-8 clr-col-12">
                <div class="card">
                    <div class="card-header"></div>
                    <div class="card-block">
                        <div class="card-title"></div>
                        <div class="card-text"></div>
                    </div>
                    <div id="violationFooter-detached" class="card-footer">
                        <button class="btn btn-sm btn-link" id="fix-detached-nodes">Fix Detachments</button>
                    </div>
                    <div id="violationFooter-hex-colors" class="card-footer">
                        <button class="btn btn-sm btn-link" id="select-hardcoded-hex-color">Select hard coded hex node</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
      const showToastButton = document.getElementById("showToastButton");
      showToastButton.onclick = () => {
          console.log(parent);
        parent.postMessage({ pluginMessage: { type: "showToast" } }, "*");
      };

      const closeButton = document.getElementById("closeButton");
      closeButton.onclick = () => {
        parent.postMessage({ pluginMessage: { type: "close" } }, "*");
      };

      const violationsCheckButton = document.getElementById("checkViolations");
      violationsCheckButton.onclick = () => {
          const showViolationCard = document.getElementById("showViolation");
          showViolationCard.style.display = "none";
          const violationFooterHexColors = document.getElementById("violationFooter-hex-colors");
          violationFooterHexColors.style.display = "none";
          const violationFooterDetached = document.getElementById("violationFooter-detached");
          violationFooterDetached.style.display = "none";

          parent.postMessage({ pluginMessage: { type: "checkViolations" } }, "*");
      };

      const detachedNodesCheckButton = document.getElementById("detachedNodes");
      detachedNodesCheckButton.onclick = () => {
          const showViolationCard = document.getElementById("showViolation");
          showViolationCard.style.display = "none";
          const violationFooterHexColors = document.getElementById("violationFooter-hex-colors");
          violationFooterHexColors.style.display = "none";
          const violationFooterDetached = document.getElementById("violationFooter-detached");
          violationFooterDetached.style.display = "none";

          parent.postMessage({ pluginMessage: { type: "find-select-detached-nodes" } }, "*");
      };

      const fixDetachedNodesCheckButton = document.getElementById("fix-detached-nodes");
      fixDetachedNodesCheckButton.onclick = () => {
          const showViolationCard = document.getElementById("showViolation");
          showViolationCard.style.display = "none";

          parent.postMessage({ pluginMessage: { type: "fix-detached-nodes" } }, "*");
      };

      const selectHardcodedHexColorsButton = document.getElementById("select-hardcoded-hex-color");
      selectHardcodedHexColorsButton.onclick = () => {
          const showViolationCard = document.getElementById("showViolation");
          showViolationCard.style.display = "none";

          parent.postMessage({ pluginMessage: { type: "select-hardcoded-hex-color" } }, "*");
      };

      window.onmessage = msg => {
          console.log(msg)
          if (msg.type !== "message") {
              return;
          }

          const showViolationCard = document.getElementById("showViolation");
          const violationFooterDetached = document.getElementById("violationFooter-detached");
          const violationFooterHexColors = document.getElementById("violationFooter-hex-colors");
          if (msg.data.pluginMessage.type === "violations") {
              console.log(msg.data.pluginMessage.data);

              const data = msg.data.pluginMessage.data

              showViolationCard.querySelector('.card-header').innerHTML = `<a class="card-link" target="_blank" href="https://42--clarity-guidance.netlify.app/${data.key}">CIP - ${data.key}</a>`;
              showViolationCard.querySelector('.card-title').innerHTML = data.rule;
              showViolationCard.querySelector('.card-text').innerHTML = data.recommendation;

              console.log(showViolationCard);

              showViolationCard.style.display = "block";

              if (data.key === "1002") {
                  violationFooterDetached.style.display = "block";
              }

              if (data.key === "1001") {
                  violationFooterHexColors.style.display = "block";
              }
          }

          if (msg.data.pluginMessage.type === "change") {
              console.log(msg.data.pluginMessage.data);

              const data = msg.data.pluginMessage.data;

              if(data.hide) {
                  showViolationCard.style.display = "none";
                  violationFooterDetached.style.display = "none";
                  violationFooterHexColors.style.display = "none";
                  return;
              }

              showViolationCard.querySelector('.card-header').innerHTML = `<a target="_blank" class="card-link" href="https://42--clarity-guidance.netlify.app/${data.key}">CIP - ${data.key}</a>`;
              showViolationCard.querySelector('.card-title').innerHTML = data.rule;
              showViolationCard.querySelector('.card-text').innerHTML = data.recommendation;

              console.log(showViolationCard);

              showViolationCard.style.display = "block";

              if (data.key === "1002") {
                  violationFooterDetached.style.display = "block";
              }

              if (data.key === "1001") {
                  violationFooterHexColors.style.display = "block";
              }
          }
      }
    </script>
</body>